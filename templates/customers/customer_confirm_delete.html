{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% translate "customers.delete" %} - ForgeLock{% endblock %}

{% block extra_css %}
<style>
    .delete-confirmation {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        border-radius: 15px;
        padding: 2rem;
        margin-bottom: 2rem;
    }
    .customer-info {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        border-radius: 15px;
        padding: 2rem;
        margin-bottom: 2rem;
    }
    .warning-icon {
        font-size: 4rem;
        color: #ff6b6b;
        margin-bottom: 1rem;
    }
    .customer-details {
        background: rgba(255, 255, 255, 0.9);
        border-radius: 10px;
        padding: 1.5rem;
        margin: 1rem 0;
    }
    .btn-group-actions {
        position: sticky;
        bottom: 0;
        background: white;
        padding: 1rem 0;
        border-top: 1px solid #dee2e6;
        z-index: 1000;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h3 mb-0">
                        <i class="fas fa-trash me-2"></i>
                        {% translate "customers.delete" %}
                    </h1>
                                    <p class="text-muted mb-0">
                    {% translate "customers.delete.confirm_deletion" %}
                </p>
                </div>
                <div>
                    <a href="{% url 'customers:customer_detail' customer.pk %}" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-2"></i>
                        {% translate "actions.back" %}
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Aviso de Exclusão -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="delete-confirmation text-center text-white">
                <div class="warning-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h3 class="mb-3">{% translate "customers.delete.warning_title" %}</h3>
                <p class="mb-0">
                    {% translate "customers.delete.irreversible_action" %}
                </p>
            </div>
        </div>
    </div>

    <!-- Informações do Cliente -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="customer-info">
                                    <h5 class="mb-3">
                        <i class="fas fa-user me-2"></i>
                        {% translate "customers.delete.customer_to_delete" %}
                    </h5>
                
                <div class="customer-details">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <strong>{% translate "customers.delete.name_label" %}</strong>
                                <span class="ms-2">{{ customer.name }}</span>
                            </div>
                            <div class="mb-3">
                                <strong>{% translate "customers.delete.email_label" %}</strong>
                                <span class="ms-2">{{ customer.email }}</span>
                            </div>
                            <div class="mb-3">
                                <strong>{% translate "customers.delete.phone_label" %}</strong>
                                <span class="ms-2">{{ customer.phone }}</span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <strong>{% translate "customers.delete.country_label" %}</strong>
                                <span class="ms-2">{{ customer.country.name }}</span>
                            </div>
                            <div class="mb-3">
                                <strong>{% translate "customers.delete.status_label" %}</strong>
                                <span class="ms-2 badge {% if customer.is_active %}bg-success{% else %}bg-secondary{% endif %}">
                                    {% if customer.is_active %}
                                        {% translate "customers.active" %}
                                    {% else %}
                                        {% translate "customers.inactive" %}
                                    {% endif %}
                                </span>
                            </div>
                            <div class="mb-3">
                                <strong>{% translate "customers.delete.registered_at" %}</strong>
                                <span class="ms-2">{{ customer.created_at|date:"d/m/Y H:i" }}</span>
                            </div>
                        </div>
                    </div>
                    
                    {% if customer.document_number %}
                    <div class="row">
                        <div class="col-12">
                            <div class="mb-3">
                                <strong>{% translate "customers.delete.document_label" %}</strong>
                                <span class="ms-2">{{ customer.get_document_display }}</span>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if customer.address or customer.city or customer.state %}
                    <div class="row">
                        <div class="col-12">
                            <div class="mb-3">
                                <strong>{% translate "customers.delete.address_label" %}</strong>
                                <span class="ms-2">
                                    {% if customer.address %}{{ customer.address }}{% endif %}
                                    {% if customer.city %}, {{ customer.city }}{% endif %}
                                    {% if customer.state %}, {{ customer.state }}{% endif %}
                                    {% if customer.zip_code %} - {{ customer.zip_code }}{% endif %}
                                </span>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if customer.notes %}
                    <div class="row">
                        <div class="col-12">
                            <div class="mb-3">
                                <strong>{% translate "customers.delete.observations_label" %}</strong>
                                <span class="ms-2">{{ customer.notes|truncatechars:100 }}</span>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Impactos da Exclusão -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="alert alert-warning">
                <h6 class="alert-heading">
                    <i class="fas fa-info-circle me-2"></i>
                    {% translate "customers.delete.what_happens_after" %}
                </h6>
                <ul class="mb-0">
                    <li>{% translate "customers.delete.permanently_removed" %}</li>
                    <li>{% translate "customers.delete.all_data_lost" %}</li>
                    <li>{% translate "customers.delete.cannot_recover" %}</li>
                    <li>{% translate "customers.delete.history_lost" %}</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Formulário de Confirmação -->
    <form method="post" class="needs-validation" novalidate>
        {% csrf_token %}
        
        <div class="row mb-4">
            <div class="col-12">
                <div class="alert alert-danger">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="confirm-delete" required>
                        <label class="form-check-label" for="confirm-delete">
                            {% translate "customers.delete.confirm_checkbox" %}
                            <strong>{{ customer.name }}</strong>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Botões de Ação -->
        <div class="btn-group-actions">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <a href="{% url 'customers:customer_detail' customer.pk %}" class="btn btn-outline-secondary">
                        <i class="fas fa-times me-2"></i>
                        {% translate "common.cancel" %}
                    </a>
                </div>
                <div>
                    <button type="submit" class="btn btn-danger" id="delete-btn" disabled>
                        <i class="fas fa-trash me-2"></i>
                        {% translate "customers.form.confirm_deletion" %}
                    </button>
                </div>
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const confirmCheckbox = document.getElementById('confirm-delete');
    const deleteBtn = document.getElementById('delete-btn');
    
    // Habilitar/desabilitar botão baseado no checkbox
    confirmCheckbox.addEventListener('change', function() {
        deleteBtn.disabled = !this.checked;
    });
    
    // Confirmação adicional antes de enviar
    const form = document.querySelector('form');
    form.addEventListener('submit', function(e) {
        if (!confirmCheckbox.checked) {
            e.preventDefault();
            alert('{% translate "customers.delete.must_confirm" %}');
            return;
        }
        
        const confirmed = confirm('{% translate "customers.delete.final_confirmation" %}');
        if (!confirmed) {
            e.preventDefault();
        }
    });
});
</script>
{% endblock %} 