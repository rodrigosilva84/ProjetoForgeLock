{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% translate "Verificação SMS - ForgeLock" %}{% endblock %}

{% block extra_css %}
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6 col-lg-4">
        <div class="verification-container">
            <h2 class="text-center mb-4">
                <i class="fas fa-mobile-alt me-2"></i>{% translate "Verificação SMS" %}
            </h2>
            
            <div class="text-center mb-4">
                <p class="mb-2">{% translate "Enviamos um código de verificação para:" %}</p>
                <strong>{{ user.phone_number }}</strong>
                <p class="text-muted small mt-2">{% translate "O código expira em" %} {{ expiry_minutes }} {% translate "minutos" %}</p>
            </div>
            
            <form method="post" novalidate>
                {% csrf_token %}
                
                <div class="mb-4">
                    <label for="{{ form.verification_code.id_for_label }}" class="form-label">{{ form.verification_code.label }}</label>
                    {{ form.verification_code }}
                    {% if form.verification_code.errors %}
                        <div class="invalid-feedback d-block">
                            {% for error in form.verification_code.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                
                <div class="d-grid mb-3">
                                    <button type="submit" class="btn btn-gradient-enabled btn-lg">
                    <i class="fas fa-check"></i>{% translate "Verificar Código" %}
                </button>
                </div>
            </form>
            
            <form method="post" action="{% url 'resend_sms' %}">
                {% csrf_token %}
                <div class="d-grid">
                    <button type="submit" class="btn btn-gradient-outline">
                        <i class="fas fa-redo"></i>{% translate "Reenviar Código" %}
                    </button>
                </div>
            </form>
            
            <hr class="my-4">
            
            <div class="text-center">
                <p class="mb-0 text-muted small">
                    {% translate "Problemas com a verificação?" %}
                    <a href="{% url 'register' %}" class="text-decoration-none">{% translate "Tente novamente" %}</a>
                </p>
            </div>
        </div>
    </div>
</div>

<script>
// Auto-foco no campo de código
document.addEventListener('DOMContentLoaded', function() {
    const codeInput = document.getElementById('{{ form.verification_code.id_for_label }}');
    if (codeInput) {
        codeInput.focus();
    }
});

// Auto-submit quando 6 dígitos forem digitados
document.addEventListener('DOMContentLoaded', function() {
    const codeInput = document.getElementById('{{ form.verification_code.id_for_label }}');
    if (codeInput) {
        codeInput.addEventListener('input', function() {
            if (this.value.length === 6) {
                this.form.submit();
            }
        });
    }
});
</script>
{% endblock %}